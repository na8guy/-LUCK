<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luckie Lottery Web App</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.5/dist/ethers.umd.min.js"></script>
    <script src="https://c0f4f41c-2f55-4863-921b-sdk-docs.github.io/cdn/metamask-sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.2/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #FFD700 0%, #28A745 50%, #6B46C1 100%);
        }
        .debug-console {
            max-height: 200px;
            overflow-y: auto;
            background-color: #1a202c;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body className="gradient-bg">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Contract addresses and ABIs
        const LOTTERY_CONTRACT_ADDRESS = '0x68cd3f484B9b75d6336B942B3FEa11FBDBDfc359';
        const LUCK_TOKEN_ADDRESS = '0x375c00DFCA476F427A47d4bca3Bd4bB6F48BEFEE';
        const CASHBACK_CONTRACT_ADDRESS = '0x8F597A098AA0943e8710c283358D9aA0e465C53D';
        const TOKEN_DISTRIBUTION_CONTRACT_ADDRESS = '0xb11aeE0628cdC3058502faF91fa8FC02686Cf2cc';
        const CHAIN_ID = 97;
        const BSC_TESTNET_RPCS = [
            'https://bsc-testnet-rpc.publicnode.com',
            'https://data-seed-prebsc-1-s1.bnbchain.org:8545',
            'https://bsc-testnet.bnbchain.org'
        ];

        const LOTTERY_CONTRACT_ABI = [
  {
    "type": "constructor",
    "inputs": [
      {
        "name": "_luckToken",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_insuranceVault",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_teamWallet",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_botAddress",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_ticketPrice",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "_subscriptionId",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "_owner",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "nonpayable"
  },
  {
    "name": "ECDSAInvalidSignature",
    "type": "error",
    "inputs": []
  },
  {
    "name": "ECDSAInvalidSignatureLength",
    "type": "error",
    "inputs": [
      {
        "name": "length",
        "type": "uint256",
        "internalType": "uint256"
      }
    ]
  },
  {
    "name": "ECDSAInvalidSignatureS",
    "type": "error",
    "inputs": [
      {
        "name": "s",
        "type": "bytes32",
        "internalType": "bytes32"
      }
    ]
  },
  {
    "name": "InvalidShortString",
    "type": "error",
    "inputs": []
  },
  {
    "name": "OnlyCoordinatorCanFulfill",
    "type": "error",
    "inputs": [
      {
        "name": "have",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "want",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "OnlyOwnerOrCoordinator",
    "type": "error",
    "inputs": [
      {
        "name": "have",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "owner",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "coordinator",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "SafeERC20FailedOperation",
    "type": "error",
    "inputs": [
      {
        "name": "token",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "StringTooLong",
    "type": "error",
    "inputs": [
      {
        "name": "str",
        "type": "string",
        "internalType": "string"
      }
    ]
  },
  {
    "name": "ZeroAddress",
    "type": "error",
    "inputs": []
  },
  {
    "name": "BotAddressSet",
    "type": "event",
    "inputs": [
      {
        "name": "newBotAddress",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "CashbackContractSet",
    "type": "event",
    "inputs": [
      {
        "name": "cashbackContract",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "CoordinatorSet",
    "type": "event",
    "inputs": [
      {
        "name": "vrfCoordinator",
        "type": "address",
        "indexed": false,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "EIP712DomainChanged",
    "type": "event",
    "inputs": [],
    "anonymous": false
  },
  {
    "name": "InsuranceVaultSet",
    "type": "event",
    "inputs": [
      {
        "name": "newVault",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "LotteryEnded",
    "type": "event",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "requestId",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "winningNumber",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "LotteryStarted",
    "type": "event",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "startTime",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "endTime",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "resultTime",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "LotteryWinner",
    "type": "event",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "winner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "prize",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "OwnershipTransferRequested",
    "type": "event",
    "inputs": [
      {
        "name": "from",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "to",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "OwnershipTransferred",
    "type": "event",
    "inputs": [
      {
        "name": "from",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "to",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "PrizeClaimed",
    "type": "event",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "winner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "prize",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "PrizePoolEnhanced",
    "type": "event",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "amount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "SubscriptionIdSet",
    "type": "event",
    "inputs": [
      {
        "name": "subscriptionId",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TeamWalletSet",
    "type": "event",
    "inputs": [
      {
        "name": "newTeamWallet",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TicketPriceSet",
    "type": "event",
    "inputs": [
      {
        "name": "newTicketPrice",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TicketsPurchased",
    "type": "event",
    "inputs": [
      {
        "name": "user",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "numberOfTickets",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "ticketNumbers",
        "type": "uint256[]",
        "indexed": false,
        "internalType": "uint256[]"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TokenTransferFailed",
    "type": "event",
    "inputs": [
      {
        "name": "to",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "amount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "data",
        "type": "bytes",
        "indexed": false,
        "internalType": "bytes"
      }
    ],
    "anonymous": false
  },
  {
    "name": "UnclaimedPrizeSwept",
    "type": "event",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "indexed": true,
        "internalType": "uint32"
      },
      {
        "name": "winner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "prize",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "WalletDelinked",
    "type": "event",
    "inputs": [
      {
        "name": "user",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "telegramId",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "WalletLinked",
    "type": "event",
    "inputs": [
      {
        "name": "user",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "telegramId",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "WeeklyRewardSet",
    "type": "event",
    "inputs": [
      {
        "name": "newWeeklyReward",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "WeeklyWinnerRewarded",
    "type": "event",
    "inputs": [
      {
        "name": "weekId",
        "type": "uint256",
        "indexed": true,
        "internalType": "uint256"
      },
      {
        "name": "winner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "reward",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "CLAIM_PERIOD",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "ENHANCEMENT_PERCENTAGE",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "INSURANCE_PERCENTAGE",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "LOTTERY_POOL_ALLOCATION",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "MAX_ENHANCEMENT_PER_ROUND",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "PRIZE_POOL_PERCENTAGE",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "TEAM_PERCENTAGE",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "WEEK_DURATION",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "acceptOwnership",
    "type": "function",
    "inputs": [],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "botAddress",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "buyTickets",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "numberOfTickets",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "buyTicketsFor",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "numberOfTickets",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "buyer",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "deadline",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "v",
        "type": "uint8",
        "internalType": "uint8"
      },
      {
        "name": "r",
        "type": "bytes32",
        "internalType": "bytes32"
      },
      {
        "name": "s",
        "type": "bytes32",
        "internalType": "bytes32"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "buyTicketsWithSignature",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "numberOfTickets",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "buyer",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "deadline",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "nonce",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "signature",
        "type": "bytes",
        "internalType": "bytes"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "cashbackContract",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "contract ICashbackContract"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "claimDeadlines",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "claimPrize",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "currentLotteryId",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "currentWeekId",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "delinkWallet",
    "type": "function",
    "inputs": [
      {
        "name": "telegramId",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "depositTokens",
    "type": "function",
    "inputs": [
      {
        "name": "amount",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "eip712Domain",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "fields",
        "type": "bytes1",
        "internalType": "bytes1"
      },
      {
        "name": "name",
        "type": "string",
        "internalType": "string"
      },
      {
        "name": "version",
        "type": "string",
        "internalType": "string"
      },
      {
        "name": "chainId",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "verifyingContract",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "salt",
        "type": "bytes32",
        "internalType": "bytes32"
      },
      {
        "name": "extensions",
        "type": "uint256[]",
        "internalType": "uint256[]"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "endLottery",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "getInsuranceVaultAddress",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getLotteryInfo",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getNonce",
    "type": "function",
    "inputs": [
      {
        "name": "buyer",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getTeamWalletAddress",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getUnclaimedPrize",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "winner",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getUserTickets",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "user",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256[]",
        "internalType": "uint256[]"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getWeekWinner",
    "type": "function",
    "inputs": [
      {
        "name": "weekId",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getWeeklyInfo",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getWeeklyReward",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "getWinners",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "address[]",
        "internalType": "address[]"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "hasParticipated",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "insuranceVault",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lotteries",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [
      {
        "name": "startTime",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "endTime",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "resultTime",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "prizePool",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "totalTickets",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lotteryEndHour",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lotteryEnded",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lotteryParticipants",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lotteryStartHour",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lotteryWinners",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "luckToken",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "contract IERC20Permit"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "owner",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "paused",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "rawFulfillRandomWords",
    "type": "function",
    "inputs": [
      {
        "name": "requestId",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "randomWords",
        "type": "uint256[]",
        "internalType": "uint256[]"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "remainingPoolAllocation",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "requestIdToLotteryId",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "resultHour",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "s_vrfCoordinator",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "contract IVRFCoordinatorV2Plus"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "setBotAddress",
    "type": "function",
    "inputs": [
      {
        "name": "_newBotAddress",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setCashbackContract",
    "type": "function",
    "inputs": [
      {
        "name": "_cashbackContract",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setCoordinator",
    "type": "function",
    "inputs": [
      {
        "name": "_vrfCoordinator",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setInsuranceVault",
    "type": "function",
    "inputs": [
      {
        "name": "_insuranceVault",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setPaused",
    "type": "function",
    "inputs": [
      {
        "name": "_paused",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setSubscriptionId",
    "type": "function",
    "inputs": [
      {
        "name": "_subscriptionId",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setTeamWallet",
    "type": "function",
    "inputs": [
      {
        "name": "_teamWallet",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setTicketPrice",
    "type": "function",
    "inputs": [
      {
        "name": "_newTicketPrice",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setWeeklyReward",
    "type": "function",
    "inputs": [
      {
        "name": "_newWeeklyReward",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "startNewLottery",
    "type": "function",
    "inputs": [],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "subscriptionId",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "sweepUnclaimedPrize",
    "type": "function",
    "inputs": [
      {
        "name": "lotteryId",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "winner",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "teamWallet",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "telegramIdToWallet",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "ticketPrice",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "transferOwnership",
    "type": "function",
    "inputs": [
      {
        "name": "to",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "unclaimedPrizes",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      },
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "verifyWallet",
    "type": "function",
    "inputs": [
      {
        "name": "telegramId",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "user",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "signature",
        "type": "bytes",
        "internalType": "bytes"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "weekIdToWinner",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "weekStartTime",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "weeklyReward",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "weeklyTicketCounts",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "weeklyTopParticipant",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "weeklyTopTickets",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "winningNumber",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "uint32",
        "internalType": "uint32"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  }
];

        const LUCK_TOKEN_ABI = [
  {
    "type": "constructor",
    "inputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "ECDSAInvalidSignature",
    "type": "error",
    "inputs": []
  },
  {
    "name": "ECDSAInvalidSignatureLength",
    "type": "error",
    "inputs": [
      {
        "name": "length",
        "type": "uint256",
        "internalType": "uint256"
      }
    ]
  },
  {
    "name": "ECDSAInvalidSignatureS",
    "type": "error",
    "inputs": [
      {
        "name": "s",
        "type": "bytes32",
        "internalType": "bytes32"
      }
    ]
  },
  {
    "name": "ERC20InsufficientAllowance",
    "type": "error",
    "inputs": [
      {
        "name": "spender",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "allowance",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "needed",
        "type": "uint256",
        "internalType": "uint256"
      }
    ]
  },
  {
    "name": "ERC20InsufficientBalance",
    "type": "error",
    "inputs": [
      {
        "name": "sender",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "balance",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "needed",
        "type": "uint256",
        "internalType": "uint256"
      }
    ]
  },
  {
    "name": "ERC20InvalidApprover",
    "type": "error",
    "inputs": [
      {
        "name": "approver",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "ERC20InvalidReceiver",
    "type": "error",
    "inputs": [
      {
        "name": "receiver",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "ERC20InvalidSender",
    "type": "error",
    "inputs": [
      {
        "name": "sender",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "ERC20InvalidSpender",
    "type": "error",
    "inputs": [
      {
        "name": "spender",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "ERC2612ExpiredSignature",
    "type": "error",
    "inputs": [
      {
        "name": "deadline",
        "type": "uint256",
        "internalType": "uint256"
      }
    ]
  },
  {
    "name": "ERC2612InvalidSigner",
    "type": "error",
    "inputs": [
      {
        "name": "signer",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "owner",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "InvalidAccountNonce",
    "type": "error",
    "inputs": [
      {
        "name": "account",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "currentNonce",
        "type": "uint256",
        "internalType": "uint256"
      }
    ]
  },
  {
    "name": "InvalidCaller",
    "type": "error",
    "inputs": [
      {
        "name": "caller",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "InvalidShortString",
    "type": "error",
    "inputs": []
  },
  {
    "name": "OwnableInvalidOwner",
    "type": "error",
    "inputs": [
      {
        "name": "owner",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "OwnableUnauthorizedAccount",
    "type": "error",
    "inputs": [
      {
        "name": "account",
        "type": "address",
        "internalType": "address"
      }
    ]
  },
  {
    "name": "ReentrancyGuardReentrantCall",
    "type": "error",
    "inputs": []
  },
  {
    "name": "StringTooLong",
    "type": "error",
    "inputs": [
      {
        "name": "str",
        "type": "string",
        "internalType": "string"
      }
    ]
  },
  {
    "name": "Approval",
    "type": "event",
    "inputs": [
      {
        "name": "owner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "spender",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "ConstructorDebug",
    "type": "event",
    "inputs": [
      {
        "name": "message",
        "type": "string",
        "indexed": false,
        "internalType": "string"
      },
      {
        "name": "account",
        "type": "address",
        "indexed": false,
        "internalType": "address"
      },
      {
        "name": "amount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "DistributionContractSet",
    "type": "event",
    "inputs": [
      {
        "name": "distributionContract",
        "type": "address",
        "indexed": false,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "EIP712DomainChanged",
    "type": "event",
    "inputs": [],
    "anonymous": false
  },
  {
    "name": "LiquidityAdded",
    "type": "event",
    "inputs": [
      {
        "name": "tokenAmount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "bnbAmount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "OwnershipTransferred",
    "type": "event",
    "inputs": [
      {
        "name": "previousOwner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "newOwner",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      }
    ],
    "anonymous": false
  },
  {
    "name": "PostTransfer",
    "type": "event",
    "inputs": [
      {
        "name": "from",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "to",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "amount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TaxesUpdated",
    "type": "event",
    "inputs": [
      {
        "name": "buyTax",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "sellTax",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TradingEnabled",
    "type": "event",
    "inputs": [],
    "anonymous": false
  },
  {
    "name": "Transfer",
    "type": "event",
    "inputs": [
      {
        "name": "from",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "to",
        "type": "address",
        "indexed": true,
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      }
    ],
    "anonymous": false
  },
  {
    "name": "TransferDebug",
    "type": "event",
    "inputs": [
      {
        "name": "sender",
        "type": "address",
        "indexed": false,
        "internalType": "address"
      },
      {
        "name": "recipient",
        "type": "address",
        "indexed": false,
        "internalType": "address"
      },
      {
        "name": "amount",
        "type": "uint256",
        "indexed": false,
        "internalType": "uint256"
      },
      {
        "name": "stage",
        "type": "string",
        "indexed": false,
        "internalType": "string"
      }
    ],
    "anonymous": false
  },
  {
    "name": "DOMAIN_SEPARATOR",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "bytes32",
        "internalType": "bytes32"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "MAX_TX_AMOUNT",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "MAX_WALLET_AMOUNT",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "TOTAL_SUPPLY",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "allowance",
    "type": "function",
    "inputs": [
      {
        "name": "owner",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "spender",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "approve",
    "type": "function",
    "inputs": [
      {
        "name": "spender",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "nonpayable"
  },
  {
    "name": "balanceOf",
    "type": "function",
    "inputs": [
      {
        "name": "account",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "burn",
    "type": "function",
    "inputs": [
      {
        "name": "value",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "burnFrom",
    "type": "function",
    "inputs": [
      {
        "name": "account",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "burnTax",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "buyTax",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "decimals",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint8",
        "internalType": "uint8"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "devTax",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "devWallet",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "distributionContract",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "eip712Domain",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "fields",
        "type": "bytes1",
        "internalType": "bytes1"
      },
      {
        "name": "name",
        "type": "string",
        "internalType": "string"
      },
      {
        "name": "version",
        "type": "string",
        "internalType": "string"
      },
      {
        "name": "chainId",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "verifyingContract",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "salt",
        "type": "bytes32",
        "internalType": "bytes32"
      },
      {
        "name": "extensions",
        "type": "uint256[]",
        "internalType": "uint256[]"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "enableTrading",
    "type": "function",
    "inputs": [],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "governanceContract",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "initializeRouter",
    "type": "function",
    "inputs": [
      {
        "name": "_pancakeSwapRouter",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "insuranceVault",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "insuranceVaultTax",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "isExemptFromAntiWhale",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "isExemptFromTax",
    "type": "function",
    "inputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lastSellTime",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "lastSellVolume",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "liquidityTax",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "name",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "string",
        "internalType": "string"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "nonces",
    "type": "function",
    "inputs": [
      {
        "name": "owner",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "owner",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "pancakeSwapPair",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "pancakeSwapRouter",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "address",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "permit",
    "type": "function",
    "inputs": [
      {
        "name": "owner",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "spender",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "deadline",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "v",
        "type": "uint8",
        "internalType": "uint8"
      },
      {
        "name": "r",
        "type": "bytes32",
        "internalType": "bytes32"
      },
      {
        "name": "s",
        "type": "bytes32",
        "internalType": "bytes32"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "renounceOwnership",
    "type": "function",
    "inputs": [],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "sellPressureThreshold",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "sellTax",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "setAddresses",
    "type": "function",
    "inputs": [
      {
        "name": "_vault",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_dev",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_pair",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "_governance",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "setDistributionContract",
    "type": "function",
    "inputs": [
      {
        "name": "_distributionContract",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "symbol",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "string",
        "internalType": "string"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "totalSupply",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "tradingEnabled",
    "type": "function",
    "inputs": [],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "view"
  },
  {
    "name": "transfer",
    "type": "function",
    "inputs": [
      {
        "name": "to",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "nonpayable"
  },
  {
    "name": "transferFrom",
    "type": "function",
    "inputs": [
      {
        "name": "from",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "to",
        "type": "address",
        "internalType": "address"
      },
      {
        "name": "value",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "name": "",
        "type": "bool",
        "internalType": "bool"
      }
    ],
    "stateMutability": "nonpayable"
  },
  {
    "name": "transferOwnership",
    "type": "function",
    "inputs": [
      {
        "name": "newOwner",
        "type": "address",
        "internalType": "address"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "name": "updateTaxes",
    "type": "function",
    "inputs": [
      {
        "name": "_buyTax",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "_sellTax",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "_vaultTax",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "_liquidityTax",
        "type": "uint256",
        "internalType": "uint256"
      },
      {
        "name": "_burnTax",
        "type": "uint256",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  }
];

        const CASHBACK_CONTRACT_ABI = [
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "cashbackBalances",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "claimCashback",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        const TOKEN_DISTRIBUTION_CONTRACT_ABI = [
            {
                "inputs": [],
                "name": "distributionAmount",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "distributionInterval",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "distributeTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "lastDistributionTime",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        function App() {
            const [action, setAction] = useState('home');
            const [userId, setUserId] = useState('');
            const [lotteryId, setLotteryId] = useState('');
            const [ticketCount, setTicketCount] = useState('');
            const [walletAddress, setWalletAddress] = useState('');
            const [error, setError] = useState('');
            const [status, setStatus] = useState('');
            const [telegramUser, setTelegramUser] = useState(null);
            const [isWalletLinked, setIsWalletLinked] = useState(false);
            const [lotteryInfo, setLotteryInfo] = useState({
                currentLotteryId: '0',
                ticketPrice: '0',
                isPaused: false,
                startTime: '0',
                endTime: '0',
                resultTime: '0',
                lotteryEnded: false,
                participants: '0',
                prizePool: '0',
                active: false
            });
            const [showBuyTicketsForm, setShowBuyTicketsForm] = useState(false);
            const [buyTicketsForm, setBuyTicketsForm] = useState({ lotteryId: '', ticketCount: '' });
            const [sdk, setSdk] = useState(null);
            const [useMetaMaskSDK, setUseMetaMaskSDK] = useState(false);
            const [debugLogs, setDebugLogs] = useState([]);
            const [showDebugConsole, setShowDebugConsole] = useState(false);

            // Custom logging function
            const logToConsole = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setDebugLogs(prev => [...prev, { timestamp, message, type }]);
                console.log(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            };

            // Check if MetaMask SDK script loaded
            useEffect(() => {
                if (typeof MetaMaskSDK === 'undefined') {
                    logToConsole('MetaMask SDK script failed to load', 'error');
                } else {
                    logToConsole('MetaMask SDK script loaded', 'success');
                    logToConsole(`MetaMaskSDK type: ${typeof MetaMaskSDK}, value: ${JSON.stringify(MetaMaskSDK).slice(0, 100)}`, 'info');
                }
            }, []);

            // Initialize wallet provider (MetaMask SDK or window.ethereum)
            useEffect(() => {
                const initializeWallet = async () => {
                    try {
                        if (useMetaMaskSDK) {
                            logToConsole('Attempting to initialize MetaMask SDK...');
                            if (typeof MetaMaskSDK === 'undefined') {
                                throw new Error('MetaMask SDK not available.');
                            }
                            const MMSDK = new MetaMaskSDK({
                                dappMetadata: {
                                    name: 'Luckie Lottery',
                                    url: window.location.href,
                                    iconUrl: 'https://na8guy.github.io/-LUCK/favicon.ico'
                                },
                                logging: { sdk: true },
                                checkInstallationImmediately: true,
                                forceInjectProvider: true
                            });
                            await MMSDK.init();
                            logToConsole('MetaMask SDK initialized successfully', 'success');
                            setSdk(MMSDK);
                        } else if (window.ethereum) {
                            logToConsole('Using window.ethereum', 'success');
                            setSdk({
                                getProvider: () => window.ethereum,
                                connect: async () => window.ethereum.request({ method: 'eth_requestAccounts' }),
                                terminate: () => {}
                            });
                        } else {
                            logToConsole('No wallet provider available. Please install MetaMask.', 'error');
                            setError('MetaMask is not installed. Please install it from https://metamask.io.');
                        }
                    } catch (err) {
                        logToConsole(`Wallet initialization failed: ${err.message}`, 'error');
                        if (window.ethereum && !useMetaMaskSDK) {
                            logToConsole('Using window.ethereum as fallback', 'warn');
                            setSdk({
                                getProvider: () => window.ethereum,
                                connect: async () => window.ethereum.request({ method: 'eth_requestAccounts' }),
                                terminate: () => {}
                            });
                        } else {
                            setError('Failed to initialize wallet: ' + err.message);
                        }
                    }
                };
                initializeWallet();
            }, [useMetaMaskSDK]);

            // Initialize Telegram Web App and fetch lottery info
            useEffect(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    logToConsole('Telegram Web App SDK loaded');
                    window.Telegram.WebApp.ready();
                    window.Telegram.WebApp.expand();
                    setTelegramUser(window.Telegram.WebApp.initDataUnsafe.user || {});
                } else {
                    logToConsole('Telegram Web App SDK not loaded', 'error');
                    setError('Telegram Web App SDK not loaded. Please access via Telegram.');
                }

                const params = new URLSearchParams(window.location.search);
                setUserId(params.get('userId') || '');
                setAction(params.get('action') || 'home');
                setLotteryId(params.get('lotteryId') || '');
                setTicketCount(params.get('ticketCount') || '');
                logToConsole(`URL Params - userId: ${params.get('userId')}, action: ${params.get('action')}`);

                const fetchLotteryInfo = async () => {
                    try {
                        logToConsole('Fetching lottery info...');
                        let provider;
                        for (const rpc of BSC_TESTNET_RPCS) {
                            try {
                                provider = new ethers.JsonRpcProvider(rpc);
                                const network = await provider.getNetwork();
                                logToConsole(`Connected to RPC ${rpc}, chain ID: ${network.chainId}`);
                                break;
                            } catch (rpcErr) {
                                logToConsole(`Failed to connect to RPC ${rpc}: ${rpcErr.message}`, 'warn');
                            }
                        }
                        if (!provider) {
                            throw new Error('All BSC Testnet RPCs failed. Please check your network.');
                        }

                        // Validate contract address
                        if (!ethers.isAddress(LOTTERY_CONTRACT_ADDRESS)) {
                            logToConsole(`Invalid contract address: ${LOTTERY_CONTRACT_ADDRESS}`, 'error');
                            throw new Error('Invalid contract address. Please verify on BSC Testnet Explorer.');
                        }
                        logToConsole(`Contract address validated: ${LOTTERY_CONTRACT_ADDRESS}`, 'info');

                        let lotteryContract;
                        try {
                            lotteryContract = new ethers.Contract(LOTTERY_CONTRACT_ADDRESS, LOTTERY_CONTRACT_ABI, provider);
                            // Check ABI compatibility
                            const functionNames = lotteryContract.interface.fragments
                                .filter(frag => frag.type === 'function')
                                .map(frag => frag.name);
                            logToConsole(`Lottery contract functions: ${functionNames.join(', ')}`);
                        } catch (contractErr) {
                            logToConsole(`Failed to initialize lottery contract: ${contractErr.message}`, 'error');
                            throw new Error('Invalid contract address or ABI. Please verify on BSC Testnet Explorer.');
                        }

                        const userIdInt = params.get('userId') ? parseInt(params.get('userId')) : 0;
                        let linkedWallet = '0x0000000000000000000000000000000000000000';
                        try {
                            if (lotteryContract.interface.getFunction('telegramIdToWallet')) {
                                linkedWallet = await lotteryContract.telegramIdToWallet(userIdInt);
                                logToConsole(`Linked wallet for userId ${userIdInt}: ${linkedWallet}`);
                            } else {
                                logToConsole('telegramIdToWallet not found in contract ABI', 'warn');
                            }
                        } catch (walletErr) {
                            logToConsole(`Failed to fetch telegramIdToWallet: ${walletErr.message}`, 'warn');
                        }

                        const ticketPrice = await lotteryContract.ticketPrice();
                        const isPaused = await lotteryContract.paused();
                        const currentLotteryId = await lotteryContract.currentLotteryId();
                        const lotteryDetails = await lotteryContract.getLotteryInfo(currentLotteryId);
                        const blockTimestamp = (await provider.getBlock('latest')).timestamp;

                        setLotteryInfo({
                            currentLotteryId: currentLotteryId.toString(),
                            ticketPrice: ethers.formatEther(ticketPrice),
                            isPaused,
                            startTime: lotteryDetails.startTime.toString(),
                            endTime: lotteryDetails.endTime.toString(),
                            resultTime: lotteryDetails.resultTime.toString(),
                            lotteryEnded: lotteryDetails.lotteryEnded,
                            participants: lotteryDetails.participants.toString(),
                            prizePool: ethers.formatEther(lotteryDetails.prizePool),
                            active: !lotteryDetails.lotteryEnded &&
                                    blockTimestamp >= lotteryDetails.startTime &&
                                    blockTimestamp < lotteryDetails.endTime
                        });

                        if (linkedWallet !== '0x0000000000000000000000000000000000000000') {
                            setIsWalletLinked(true);
                            setWalletAddress(linkedWallet);
                        }
                        logToConsole('Lottery info fetched successfully', 'success');
                    } catch (err) {
                        logToConsole(`Fetch lottery info failed: ${err.message}`, 'error');
                        setError(`Failed to fetch lottery info: ${err.message}`);
                    }
                };
                fetchLotteryInfo();
            }, []);

            // Trigger confetti animation
            const triggerConfetti = () => {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#FFD700', '#28A745', '#6B46C1']
                });
            };

            // Connect wallet
            const connectWallet = async () => {
                if (!sdk) {
                    logToConsole('Wallet provider not initialized', 'error');
                    setError('Wallet provider not available. Please install MetaMask from https://metamask.io.');
                    return null;
                }
                try {
                    setError('');
                    setStatus('Connecting to wallet...');
                    logToConsole('Attempting to connect wallet');

                    const providerAvailable = sdk.getProvider();
                    if (!providerAvailable) {
                        logToConsole('Wallet provider not detected', 'error');
                        throw new Error('Wallet provider not detected. Please ensure MetaMask is installed.');
                    }
                    logToConsole('Wallet provider detected');

                    const accounts = await sdk.connect();
                    if (!accounts || accounts.length === 0) {
                        logToConsole('No accounts returned', 'error');
                        throw new Error('No accounts returned by wallet.');
                    }
                    logToConsole(`Connected account: ${accounts[0]}`);

                    const provider = new ethers.BrowserProvider(sdk.getProvider());
                    const signer = await provider.getSigner();
                    const address = accounts[0];
                    const currentChainId = Number((await provider.getNetwork()).chainId);
                    logToConsole(`Current chain ID: ${currentChainId}`);

                    if (currentChainId !== CHAIN_ID) {
                        logToConsole(`Switching to chain ID ${CHAIN_ID} (BSC Testnet)`);
                        try {
                            await sdk.getProvider().request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: `0x${CHAIN_ID.toString(16)}` }],
                            });
                            logToConsole('Network switched successfully', 'success');
                        } catch (switchError) {
                            if (switchError.code === 4902) {
                                logToConsole('Adding BSC Testnet to wallet');
                                await sdk.getProvider().request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: `0x${CHAIN_ID.toString(16)}`,
                                        chainName: 'BNB Chain Testnet',
                                        rpcUrls: ['https://bsc-testnet-rpc.publicnode.com'],
                                        nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
                                        blockExplorerUrls: ['https://testnet.bscscan.com']
                                    }],
                                });
                                logToConsole('BSC Testnet added successfully', 'success');
                            } else {
                                logToConsole(`Network switch failed: ${switchError.message}`, 'error');
                                throw new Error('Failed to switch to BSC Testnet. Please switch manually in MetaMask.');
                            }
                        }
                    }

                    setWalletAddress(address);
                    setStatus('Wallet connected! ');
                    logToConsole(`Wallet connected: ${address}`, 'success');
                    triggerConfetti();
                    return { provider, signer, address };
                } catch (err) {
                    logToConsole(`Connect wallet error: ${err.message} (Code: ${err.code})`, 'error');
                    let errorMessage = 'Failed to connect wallet';
                    if (err.code === 4001) {
                        errorMessage = 'Connection rejected by user';
                    } else if (err.message.includes('No accounts')) {
                        errorMessage = 'No accounts available in wallet. Please add an account.';
                    } else if (err.message.includes('Wallet provider not detected')) {
                        errorMessage = 'MetaMask is not installed. Please install it from https://metamask.io.';
                    } else if (err.message.includes('Failed to switch')) {
                        errorMessage = err.message;
                    } else {
                        errorMessage = `Failed to connect wallet: ${err.message}`;
                    }
                    setError(errorMessage);
                    setStatus('');
                    return null;
                }
            };

            // Disconnect wallet
            const disconnectWallet = () => {
                setWalletAddress('');
                setIsWalletLinked(false);
                if (sdk) {
                    sdk.terminate();
                    setSdk(null);
                    logToConsole('Wallet provider terminated', 'success');
                }
                setStatus('Wallet delinked! Please disconnect MetaMask manually if needed. ');
                logToConsole('Wallet disconnected from UI', 'success');
                triggerConfetti();
            };

            // Execute blockchain actions
            const executeAction = async (actionToExecute) => {
                try {
                    setError('');
                    setStatus('Processing transaction...');
                    logToConsole(`Executing action: ${actionToExecute}`);

                    if (!userId || isNaN(parseInt(userId))) {
                        logToConsole('Invalid Telegram User ID', 'error');
                        throw new Error('Invalid Telegram User ID.');
                    }

                    const wallet = await connectWallet();
                    if (!wallet) {
                        logToConsole('Wallet connection failed', 'error');
                        throw new Error('Wallet connection failed.');
                    }
                    const { provider, signer, address } = wallet;
                    logToConsole(`Using wallet address: ${address}`);

                    const lotteryContract = new ethers.Contract(LOTTERY_CONTRACT_ADDRESS, LOTTERY_CONTRACT_ABI, signer);
                    const luckTokenContract = new ethers.Contract(LUCK_TOKEN_ADDRESS, LUCK_TOKEN_ABI, signer);
                    const cashbackContract = new ethers.Contract(CASHBACK_CONTRACT_ADDRESS, CASHBACK_CONTRACT_ABI, signer);
                    const tokenDistributionContract = new ethers.Contract(TOKEN_DISTRIBUTION_CONTRACT_ADDRESS, TOKEN_DISTRIBUTION_CONTRACT_ABI, signer);

                    if (lotteryInfo.isPaused && actionToExecute !== 'claim_cashback' && actionToExecute !== 'token_distribution' && actionToExecute !== 'delink_wallet') {
                        logToConsole('Lottery contract is paused', 'error');
                        throw new Error('Lottery contract is paused. Try again later.');
                    }

                    let tx;
                    switch (actionToExecute) {
                        case 'set_wallet': {
                            if (!lotteryContract.interface.getFunction('telegramIdToWallet')) {
                                logToConsole('telegramIdToWallet not supported by contract', 'error');
                                throw new Error('telegramIdToWallet not supported by the contract.');
                            }
                            const existingWallet = await lotteryContract.telegramIdToWallet(parseInt(userId));
                            logToConsole(`Existing wallet for userId ${userId}: ${existingWallet}`);
                            if (existingWallet !== '0x0000000000000000000000000000000000000000' &&
                                existingWallet.toLowerCase() !== address.toLowerCase()) {
                                logToConsole(`Telegram ID linked to another wallet: ${existingWallet}`, 'error');
                                throw new Error(`This Telegram ID is linked to another wallet (${existingWallet}).`);
                            }
                            tx = await lotteryContract.linkWallet(parseInt(userId), { gasLimit: 200000 });
                            logToConsole(`linkWallet transaction sent: ${tx.hash}`);
                            break;
                        }
                        case 'buy_tickets': {
                            if (!buyTicketsForm.lotteryId || isNaN(parseInt(buyTicketsForm.lotteryId)) ||
                                !buyTicketsForm.ticketCount || isNaN(parseInt(buyTicketsForm.ticketCount)) ||
                                parseInt(buyTicketsForm.ticketCount) <= 0) {
                                logToConsole('Invalid lottery ID or ticket count', 'error');
                                throw new Error('Invalid lottery ID or ticket count.');
                            }
                            const ticketPrice = await lotteryContract.ticketPrice();
                            const totalCost = ticketPrice * BigInt(buyTicketsForm.ticketCount);
                            const balance = await luckTokenContract.balanceOf(address);
                            logToConsole(`Ticket price: ${ethers.formatEther(ticketPrice)}, Total cost: ${ethers.formatEther(totalCost)}, Balance: ${ethers.formatEther(balance)}`);
                            if (balance < totalCost) {
                                logToConsole(`Insufficient $LUCK balance`, 'error');
                                throw new Error(`Insufficient $LUCK balance: ${ethers.formatEther(balance)} available, ${ethers.formatEther(totalCost)} needed.`);
                            }

                            setStatus('Requesting token approval...');
                            tx = await luckTokenContract.approve(LOTTERY_CONTRACT_ADDRESS, totalCost, { gasLimit: 100000 });
                            const approvalReceipt = await tx.wait();
                            logToConsole(`Token approval transaction: ${tx.hash}, Status: ${approvalReceipt.status}`);
                            if (approvalReceipt.status !== 1) {
                                logToConsole('Token approval failed', 'error');
                                throw new Error('Token approval failed.');
                            }
                            setStatus('Token approval successful! Processing ticket purchase...');

                            tx = await lotteryContract.buyTickets(parseInt(buyTicketsForm.lotteryId), parseInt(buyTicketsForm.ticketCount), { gasLimit: 300000 });
                            logToConsole(`buyTickets transaction sent: ${tx.hash}`);
                            break;
                        }
                        case 'claim_cashback': {
                            const cashbackBalance = await cashbackContract.cashbackBalances(address);
                            logToConsole(`Cashback balance: ${ethers.formatEther(cashbackBalance)}`);
                            if (cashbackBalance === 0n) {
                                logToConsole('No cashback available', 'error');
                                throw new Error('No cashback available to claim.');
                            }
                            tx = await cashbackContract.claimCashback({ gasLimit: 200000 });
                            logToConsole(`claimCashback transaction sent: ${tx.hash}`);
                            break;
                        }
                        case 'token_distribution': {
                            const lastDistributionTime = await tokenDistributionContract.lastDistributionTime(address);
                            const distributionInterval = await tokenDistributionContract.distributionInterval();
                            const currentTime = Math.floor(Date.now() / 1000);
                            logToConsole(`Last distribution: ${lastDistributionTime}, Interval: ${distributionInterval}, Current time: ${currentTime}`);
                            if (lastDistributionTime > 0 && (currentTime - lastDistributionTime) < distributionInterval) {
                                const nextTime = new Date((lastDistributionTime + distributionInterval) * 1000).toUTCString();
                                logToConsole(`Next distribution available after ${nextTime}`, 'error');
                                throw new Error(`Next distribution available after ${nextTime}.`);
                            }
                            const amount = await tokenDistributionContract.distributionAmount();
                            logToConsole(`Distribution amount: ${ethers.formatEther(amount)}`);
                            if (amount === 0n) {
                                logToConsole('No tokens available for distribution', 'error');
                                throw new Error('No tokens available for distribution.');
                            }
                            tx = await tokenDistributionContract.distributeTokens({ gasLimit: 200000 });
                            logToConsole(`distributeTokens transaction sent: ${tx.hash}`);
                            break;
                        }
                        case 'delink_wallet': {
                            if (!lotteryContract.interface.getFunction('telegramIdToWallet')) {
                                logToConsole('telegramIdToWallet not supported by contract', 'error');
                                throw new Error('telegramIdToWallet not supported by the contract.');
                            }
                            const existingWallet = await lotteryContract.telegramIdToWallet(parseInt(userId));
                            logToConsole(`Existing wallet for userId ${userId}: ${existingWallet}`);
                            if (existingWallet === '0x0000000000000000000000000000000000000000') {
                                logToConsole('No wallet linked to this Telegram ID', 'error');
                                throw new Error('No wallet linked to this Telegram ID.');
                            }
                            if (existingWallet.toLowerCase() !== address.toLowerCase()) {
                                logToConsole(`Connected wallet (${address}) does not match linked wallet (${existingWallet})`, 'error');
                                throw new Error(`Connected wallet (${address}) does not match linked wallet (${existingWallet}).`);
                            }
                            tx = await lotteryContract.delinkWallet(parseInt(userId), { gasLimit: 200000 });
                            logToConsole(`delinkWallet transaction sent: ${tx.hash}`);
                            break;
                        }
                        default:
                            logToConsole('Invalid action specified', 'error');
                            throw new Error('Invalid action specified.');
                    }

                    const receipt = await tx.wait();
                    logToConsole(`Transaction confirmed: ${receipt.hash}`, 'success');
                    setStatus(`Transaction successful! Hash: ${receipt.hash} `);
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.showAlert('Transaction completed successfully!');
                    }

                    if (actionToExecute === 'delink_wallet' && window.Telegram && window.Telegram.WebApp) {
                        logToConsole('Sending delink_wallet data to Telegram bot');
                        window.Telegram.WebApp.sendData(JSON.stringify({
                            action: 'delink_wallet',
                            userId: userId,
                            success: true,
                            txHash: receipt.hash
                        }));
                    }

                    if (actionToExecute === 'set_wallet') {
                        setIsWalletLinked(true);
                        triggerConfetti();
                    } else if (actionToExecute === 'delink_wallet') {
                        disconnectWallet();
                    }
                    if (actionToExecute === 'buy_tickets') {
                        setShowBuyTicketsForm(false);
                        setBuyTicketsForm({ lotteryId: '', ticketCount: '' });
                    }
                } catch (err) {
                    logToConsole(`Execute action error: ${err.message} (Code: ${err.code})`, 'error');
                    let errorMessage = err.message || 'Transaction failed';
                    if (err.code === 4001) {
                        errorMessage = 'Transaction rejected by user';
                    } else if (err.reason) {
                        errorMessage = err.reason;
                    }
                    setError(`Error: ${errorMessage}`);
                    setStatus('');
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.showAlert(`Error: ${errorMessage}`);
                    }
                }
            };

            // Handle Buy Tickets form submission
            const handleBuyTicketsSubmit = (e) => {
                e.preventDefault();
                logToConsole('Submitting buy tickets form');
                executeAction('buy_tickets');
            };

            // Format timestamp to readable date
            const formatTimestamp = (timestamp) => {
                if (!timestamp || timestamp === '0') return 'N/A';
                return new Date(parseInt(timestamp) * 1000).toLocaleString('en-US', {
                    dateStyle: 'medium',
                    timeStyle: 'short'
                });
            };

            // Render action buttons
            const renderActionButtons = () => (
                <div className="space-y-4 animate-fade-in">
                    <button
                        onClick={() => setShowBuyTicketsForm(true)}
                        className="w-full bg-yellow-500 text-white py-3 px-4 rounded-lg hover:bg-yellow-600 transition transform hover:scale-105"
                    >
                         Buy Tickets
                    </button>
                    <button
                        onClick={() => executeAction('claim_cashback')}
                        className="w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition transform hover:scale-105"
                    >
                         Claim Cashback
                    </button>
                    <button
                        onClick={() => executeAction('token_distribution')}
                        className="w-full bg-purple-500 text-white py-3 px-4 rounded-lg hover:bg-purple-600 transition transform hover:scale-105"
                    >
                         Claim Token Distribution
                    </button>
                    <button
                        onClick={() => executeAction('delink_wallet')}
                        className="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition transform hover:scale-105"
                    >
                         Delink Wallet
                    </button>
                </div>
            );

            // Render debug console and SDK toggle
            const renderDebugConsole = () => (
                <div className="mt-4">
                    <div className="flex items-center justify-between mb-2">
                        <label className="text-sm text-gray-700">Use MetaMask SDK</label>
                        <input
                            type="checkbox"
                            checked={useMetaMaskSDK}
                            onChange={(e) => setUseMetaMaskSDK(e.target.checked)}
                            className="h-5 w-5"
                        />
                    </div>
                    <button
                        onClick={() => setShowDebugConsole(!showDebugConsole)}
                        className="w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition"
                    >
                        {showDebugConsole ? 'Hide Debug Console' : 'Show Debug Console'}
                    </button>
                    {showDebugConsole && (
                        <div className="debug-console mt-2">
                            {debugLogs.map((log, index) => (
                                <div key={index} className={log.type === 'error' ? 'text-red-400' : log.type === 'warn' ? 'text-yellow-400' : 'text-gray-200'}>
                                    [{log.timestamp}] {log.message}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full animate-fade-in">
                        <h1 className="text-3xl font-bold text-center mb-4 text-purple-600">Luckie Lottery </h1>
                        {telegramUser && (
                            <p className="text-sm text-gray-600 mb-4 text-center">
                                Welcome, {telegramUser.first_name || 'User'}! (ID: {userId}) 
                            </p>
                        )}
                        {!isWalletLinked ? (
                            <div className="text-center">
                                <h2 className="text-2xl font-semibold mb-6 text-yellow-600">Join the Lottery Fun! </h2>
                                <p className="text-gray-700 mb-6">
                                    Link your MetaMask wallet to start playing the Luckie Lottery! 
                                </p>
                                <button
                                    onClick={() => executeAction('set_wallet')}
                                    className="w-full bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition transform hover:scale-105 animate-pulse"
                                >
                                     Connect MetaMask
                                </button>
                                {status && <p className="mt-4 text-sm text-green-600">{status}</p>}
                                {error && <p className="mt-4 text-sm text-red-600">{error}</p>}
                            </div>
                        ) : (
                            <div>
                                <h2 className="text-2xl font-semibold mb-4 text-green-600">Ready to Win Big? </h2>
                                <p className="text-sm text-gray-600 mb-4">
                                    Connected Wallet: {walletAddress.slice(0, 6)}...{walletAddress.slice(-4)} 
                                </p>
                                <div className="bg-yellow-100 p-4 rounded-lg mb-6">
                                    <h3 className="text-lg font-bold text-yellow-700">Lottery Info </h3>
                                    <p><strong>Lottery ID:</strong> {lotteryInfo.currentLotteryId}</p>
                                    <p><strong>Ticket Price:</strong> {lotteryInfo.ticketPrice} $LUCK</p>
                                    <p><strong>Start Time:</strong> {formatTimestamp(lotteryInfo.startTime)}</p>
                                    <p><strong>End Time:</strong> {formatTimestamp(lotteryInfo.endTime)}</p>
                                    <p><strong>Result Time:</strong> {formatTimestamp(lotteryInfo.resultTime)}</p>
                                    <p><strong>Prize Pool:</strong> {lotteryInfo.prizePool} $LUCK</p>
                                    <p><strong>Participants:</strong> {lotteryInfo.participants}</p>
                                    <p><strong>Status:</strong> {lotteryInfo.active ? 'Active ' : 'Inactive '}</p>
                                    {lotteryInfo.isPaused && (
                                        <p className="text-red-600"> Lottery contract is paused. Delinking, cashback, and token distribution are still available!</p>
                                    )}
                                </div>
                                {showBuyTicketsForm ? (
                                    <form onSubmit={handleBuyTicketsSubmit} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Lottery ID</label>
                                            <input
                                                type="number"
                                                value={buyTicketsForm.lotteryId}
                                                onChange={(e) => setBuyTicketsForm({ ...buyTicketsForm, lotteryId: e.target.value })}
                                                className="w-full p-2 border rounded-lg"
                                                placeholder="Enter Lottery ID"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Number of Tickets</label>
                                            <input
                                                type="number"
                                                value={buyTicketsForm.ticketCount}
                                                onChange={(e) => setBuyTicketsForm({ ...buyTicketsForm, ticketCount: e.target.value })}
                                                className="w-full p-2 border rounded-lg"
                                                placeholder="Enter ticket count"
                                                min="1"
                                                required
                                            />
                                        </div>
                                        <button
                                            type="submit"
                                            className="w-full bg-yellow-500 text-white py-3 px-4 rounded-lg hover:bg-yellow-600 transition"
                                        >
                                            Confirm Purchase 
                                        </button>
                                        <button
                                            onClick={() => setShowBuyTicketsForm(false)}
                                            className="w-full bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 transition"
                                        >
                                            Cancel
                                        </button>
                                    </form>
                                ) : (
                                    renderActionButtons()
                                )}
                                {status && <p className="mt-4 text-sm text-green-600">{status}</p>}
                                {error && <p className="mt-4 text-sm text-red-600">{error}</p>}
                            </div>
                        )}
                        {renderDebugConsole()}
                        <div className="mt-6 text-sm text-gray-500 text-center">
                            <p>Need testnet BNB for gas fees? Get it here:</p>
                            <a
                                href="https://www.bnbchain.org/en/testnet-faucet"
                                target="_blank"
                                className="text-blue-500 hover:underline"
                            >
                                BNB Testnet Faucet
                            </a>
                        </div>
                    </div>
                </div>
            );
        }

        // Tailwind animation for fade-in
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>